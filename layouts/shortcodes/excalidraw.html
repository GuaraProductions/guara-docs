{{/*
  Excalidraw SVG Shortcode with Zoom and Pan
  
  Usage:
    {{< excalidraw src="diagrams/my-diagram.svg" alt="My Diagram" >}}
    {{< excalidraw src="diagrams/my-diagram.svg" alt="My Diagram" width="800" height="600" >}}
  
  Parameters:
    - src (required): Path to the SVG file relative to static/ folder
    - alt (optional): Alt text for accessibility
    - width (optional): Container width (default: 100%)
    - height (optional): Container height (default: 600px)
*/}}

{{ $src := .Get "src" }}
{{ $alt := .Get "alt" | default "Excalidraw Diagram" }}
{{ $width := .Get "width" | default "100%" }}
{{ $height := .Get "height" | default "600px" }}
{{ $id := printf "excalidraw-%d" now.UnixNano }}

<div class="excalidraw-container" style="width: {{ $width }}; height: {{ $height }}; border: 1px solid #e5e7eb; border-radius: 0.5rem; overflow: hidden; position: relative; background-color: #ffffff;">
  <div id="{{ $id }}" class="excalidraw-svg-wrapper" style="width: 100%; height: 100%; cursor: grab;">
    <object data="{{ $src | relURL }}" type="image/svg+xml" aria-label="{{ $alt }}" style="width: 100%; height: 100%; pointer-events: none;">
      <img src="{{ $src | relURL }}" alt="{{ $alt }}" style="width: 100%; height: 100%;">
    </object>
  </div>
  <div class="excalidraw-controls" style="position: absolute; top: 10px; right: 10px; display: flex; gap: 0.5rem; z-index: 10;">
    <button onclick="excalidrawZoom('{{ $id }}', 'in')" 
            style="background: white; border: 1px solid #d1d5db; border-radius: 0.25rem; padding: 0.5rem; cursor: pointer; box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05);"
            aria-label="Zoom In">
      <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M8 3V13M3 8H13" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
      </svg>
    </button>
    <button onclick="excalidrawZoom('{{ $id }}', 'out')" 
            style="background: white; border: 1px solid #d1d5db; border-radius: 0.25rem; padding: 0.5rem; cursor: pointer; box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05);"
            aria-label="Zoom Out">
      <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M3 8H13" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
      </svg>
    </button>
    <button onclick="excalidrawZoom('{{ $id }}', 'reset')" 
            style="background: white; border: 1px solid #d1d5db; border-radius: 0.25rem; padding: 0.5rem; cursor: pointer; box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05);"
            aria-label="Reset Zoom">
      <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M2 8C2 4.686 4.686 2 8 2C11.314 2 14 4.686 14 8C14 11.314 11.314 14 8 14" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
        <path d="M5 14L2 14L2 11" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
      </svg>
    </button>
  </div>
</div>

<script>
  // Initialize the diagram when loaded
  (function() {
    const container = document.getElementById('{{ $id }}');
    if (container && !container.dataset.initialized) {
      window.initExcalidrawPanZoom('{{ $id }}');
      container.dataset.initialized = 'true';
    }
  })();
</script>
